<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Test #6</title>
        <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
        <style type="text/css">
            circle {
                fill : steelblue;
            }
            circle:hover {
                fill : brown;
            }
            button {
                display : block;
            }
            .axis path,
            .axis line {
                fill: none;
                stroke: black;
                shape-rendering: crispEdges;
            }
            .axis text {
                font-family: sans-serif;
                font-size: 11px;
            }

        </style>
    </head>
    <body>
        <button>new data</button>
        <script type="text/javascript">

            /* initialize global variables */
            var dataset,
                numPoints = 15,
                width = 500,
                height = 300,
                padding = 60,
                paddingR = 100,
                radius = 3,
                duration = 500,
                ticks = 5;

            /* generate new data */
            var newData = function(){
                dataset = [];
                for(var i = 0; i < numPoints; i++) {
                    var subset = [];
                    for(var k = 0; k < 2; k++) {
                        var val = Math.round(Math.random() * 1000);
                        subset.push(val);
                    }
                    dataset.push(subset);
                }
            };

            newData();

            /* initialize scaling functions */
            var xScale = d3.scale.linear()
                           .domain([0, d3.max(dataset, function(d){ return d[0]; })])
                           .range([padding, width - paddingR]);

            var yScale = d3.scale.linear()
                           .domain([0, d3.max(dataset, function(d){ return d[1]; })])
                           .range([height - padding, padding]); /* inverted to orient high values to top */

            /* create svg elements for initial dataset */
            var svg = d3.select("body").append("svg")
                          .attr("width", width)
                          .attr("height", height);

            var circle = svg.selectAll("circle").data(dataset)
                .enter()
              .append("circle")
                .attr({
                    "cx" : function(d){ return xScale(d[0]); },
                    "cy" : function(d){ return yScale(d[1]); },
                    "r" : radius
                });

            var text = svg.selectAll("text").data(dataset)
                .enter()
              .append("text")
                .text(function(d){ return "(" + d[0] + ", " + d[1] + ")"})
                .attr({
                    "text-anchor" : "left",
                    "font-family" : "sans-serif",
                    "font-size" : "10px",
                    "fill" : "#ccc",
                    "x" : function(d){ return xScale(d[0]) + 5;},
                    "y" : function(d){ return yScale(d[1]) - 3;}
                });

            var xAxis = d3.svg.axis()
                              .scale(xScale)
                              .orient("bottom")
                              .ticks(ticks);

            var yAxis = d3.svg.axis()
                              .scale(yScale)
                              .orient("left")
                              .ticks(ticks);

            svg.append("g").attr("class", "x axis")
                           .attr("transform", "translate(0," + (height - padding) + ")") /* push axis to bottom */
                           .call(xAxis);

            svg.append("g").attr("class", "y axis")
                           .attr("transform", "translate(" + padding + ",0)") /* push axis to left */
                           .call(yAxis);

            /* log initial parameters to console */
            console.log(dataset);

            /* generate new data on button click */
            d3.select("button").on("click", function(){
                //generate new data set
                newData();

                //Update scales
                yScale.domain([0, d3.max(dataset, function(d){ return d[1]; })]);
                xScale.domain([0, d3.max(dataset, function(d){ return d[0]; })]);

                //Update circle positions
                circle.data(dataset)
                    .transition()
                    .duration(duration)
                    .attr({
                        "cx" : function(d){ return xScale(d[0]); },
                        "cy" : function(d){ return yScale(d[1]); }
                    });

                //Update coordinate text
                text.data(dataset)
                    .transition()
                    .duration(duration)
                    .text(function(d){ return "(" + d[0] + ", " + d[1] + ")"})
                    .attr({
                        "x" : function(d){ return xScale(d[0]) + 5;},
                        "y" : function(d){ return yScale(d[1]) - 3;}
                    });

                //Update x-axis
                svg.select(".x.axis")
                    .transition()
                    .duration(duration)
                    .call(xAxis);

                //Update y-axis
                svg.select(".y.axis")
                    .transition()
                    .duration(duration)
                    .call(yAxis);
            });

        </script>
    </body>
</html>
